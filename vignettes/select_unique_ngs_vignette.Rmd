---
title: "select_unique_ngs() tutorial"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{select_unique_ngs() tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>", warning = F, message = F
)

library(genieBPC)
library(tibble)
library(magrittr)
library(dplyr)
library(synapser)
library(gt)

gt_compact_fun <- function(x) {
  gt::tab_options(x, 
                  table.font.size = 'small',
                  data_row.padding = gt::px(1),
                  summary_row.padding = gt::px(1),
                  grand_summary_row.padding = gt::px(1),
                  footnotes.padding = gt::px(1),
                  source_notes.padding = gt::px(1),
                  row_group.padding = gt::px(1))
}

synLogin()
```


## Introduction

The `genieBPC` package allows users to link the clinical data to patients' corresponding genomic samples. 

This tutorial will utilize the data downloaded in the `pull_data_synapse()` vignette and processed in the `create_analytic_cohort()` vignettes, as shown below:

```{r, results = 'hide'}
nsclc_cohort <- pull_data_synapse("NSCLC", version = "2.1")

nsclc_stg_iv_adeno <- create_analytic_cohort(
  cohort = "NSCLC",
  data_synapse = nsclc_cohort,
  stage_dx = "Stage IV",
  histology = "Adenocarcinoma",
  regimen_drugs = c("Carboplatin, Pemetrexed Disodium",
                    "Cisplatin, Pemetrexed Disodium",
                    "Bevacizumab, Carboplatin, Pemetrexed Disodium",
                    "Bevacizumab, Cisplatin, Pemetrexed Disodium"),
  regimen_type = "Exact",
  regimen_order = 1,
  regimen_order_type = "within cancer",
  return_summary = FALSE
)
```


## Modifying Function Arguments


```{r, include = FALSE}
tbl_arguments = tibble::tribble(
  ~Argument,       ~Description,
  "`data_cohort`",       "List of samples collected for each cancer. Defined by ‘cohort_ngs’ object returned by create_analytic_cohort() function. Only required parameter for this function.",
  "`oncotree_code`",       "Prioritizes samples defined by any OncoTree code value (e.g.: “LUAD”, “CRC”). Default is NULL.",
  "`sample_type`",        "Prioritizes sample type. Must be one of 'Primary' or 'Metastatic'. Default is NULL.",
  "`min_max_time`",        "Prioritize the patient's first or last sample recorded, if multiple are available. Can take values 'min' or 'max'. Default is NULL.") %>%
  gt::gt() %>%
  gt::tab_header(title = "`select_unique_ngs()` Function Arguments") %>% 
  gt::fmt_markdown(columns = c(Argument)) %>%
  gt::tab_options(table.font.size = 'small',
                  data_row.padding = gt::px(1),
                  summary_row.padding = gt::px(1),
                  grand_summary_row.padding = gt::px(1),
                  footnotes.padding = gt::px(1),
                  source_notes.padding = gt::px(1),
                  row_group.padding = gt::px(1)) %>%
  gt_compact_fun()

tbl_arguments
```


```{r, echo = FALSE}
tbl_arguments
```


*Note: If multiple samples for a patient meet the criteria of all parameters selected, the sample with the largest panel size for sequence assay will be chosen.*

## Example

Select one unique metastatic lung adenocarcinoma genomic sample per patient.

```{r, results = 'hide'}
nsclc_stg_iv_adeno_unique_sample <- select_unique_ngs( 
  data_cohort = nsclc_stg_iv_adeno$cohort_ngs, 
  oncotree_code = "LUAD",
  sample_type = "Metastasis"
)
```

